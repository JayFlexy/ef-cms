const {
  getCreateACaseButton,
  navigateTo: navigateToDocumentQC,
} = require('../support/pages/document-qc');

const {
  fillInCreateCaseFromPaperForm,
} = require('../support/pages/create-paper-petition');

describe('Verify functionality of autogenerated NANE after serving a case', function () {
  before(() => {
    navigateToDocumentQC('petitionsclerk');

    getCreateACaseButton().click();
  });

  it('should create a case with a NANE', () => {
    let docketNumberToVisit = '';
    fillInCreateCaseFromPaperForm();

    cy.intercept('POST', '**/paper').as('postPaperCase');
    cy.get('#submit-case').click();
    cy.wait('@postPaperCase').then(({ response }) => {
      console.log('response*** ', response);
      docketNumberToVisit = response.body.docketNumber;
      console.log('docketNumber*** ', docketNumberToVisit);
      cy.get('#orders-notices-auto-created-in-draft').should('exist');
      // submit case on Case Reveiw Page
      cy.get('#submit-case').scrollIntoView().click();

      // confirm serve in modal
      cy.get('#confirm').click();

      // click done in View Paper Petition Reciept page
      cy.get('#done-viewing-paper-petition-receipt-button').click();

      // go to Case Detail page
      console.log('docketNumberAfter*** ', docketNumberToVisit);
      cy.visit(`/case-detail/${docketNumberToVisit}`);
    });
  });

  it('should check that Draft Tab Icon exist with count of 1', () => {
    cy.get('#tab-drafts').click();
    cy.get('.icon-tab-unread-messages-count').should('have.text', '1');
  });
});
